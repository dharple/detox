language: c

os: linux

dist: focal

jobs:
  include:
    # test gcc across architectures on file default (focal)
    - arch: amd64
      compiler: gcc
    - arch: ppc64le
      compiler: gcc
    - arch: arm64
      compiler: gcc
    # test clang on amd6 on file default (focal)
    - arch: amd64
      compiler: clang
    # test gcc on amd64 across older versions
    - arch: amd64
      compiler: gcc
      dist: bionic
    - arch: amd64
      compiler: gcc
      dist: xenial
    - arch: amd64
      compiler: gcc
      dist: trusty
    # test macOS on latest
    - os: osx
      osx_image: xcode12.2
      addons:
        homebrew:
          packages:
          - bash
          - sed

env:
  global:
    - MAKEFLAGS="-j 2"

install:
  - autoreconf --install

script:
  - ./configure && make
  - src/detox -V
  - tests/travis.sh src/detox
